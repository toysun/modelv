<!DOCTYPE html>
<html lang="ko">
  <head>
    <title>AR Ìè¨ÌÜ†Ï°¥</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="./js/webcomponents-loader.js"></script>
    <script src="./js/intersection-observer.js"></script>
    <script src="./js/ResizeObserver.js"></script>
    <script src="./js/fullscreen.polyfill.js"></script>
    <script src="./js/prismatic.min.js"></script>
    <script src="./js/focus-visible.js" defer></script>
      
  </head>
  <body>
    
    <div class="overlay-ui top-bar">
        <button id="map-btn" class="ui-button">üó∫Ô∏è ÌñâÏÑ± ÏßÄÎèÑ</button>
    </div>
    
    <section class="attribution">
      <span>
        <img
          src="./images/joayong-title-black.png"
          alt="ocean breeze"
          class="center"
        />
      </span>
    </section>

    <model-viewer
      style="background-color: #E8E8E8"
      interaction-prompt="auto"
      auto-rotate
      autoplay
      ar
      ar-modes="scene-viewer webxr"
      magic-leap
      quick-look-browsers="safari chrome"
      shadow-intensity="2"
      environment-image="neutral"
      ar-scale="0.25"
      camera-controls
      touch-action="pan-y"
      camera-target="0m -1.1m 0m"
      camera-orbit="-30deg auto auto"
      max-camera-orbit="auto 100deg auto"
    >
      <button aria-label="ÏóêÏù¥ÏïåÎ°ú Î≥¥Í∏∞" slot="ar-button" id="ar-button">AR Ìè¨ÌÜ†Ï°¥ Î≥¥Í∏∞</button>

      <div id="ar-prompt">
        <img alt="ÏóêÏù¥Ïïå ÏÜêÌùîÎì§Í∏∞" src="./images/hand.png" />
      </div>
      <div class="progress-bar hide" slot="progress-bar">
        <div class="update-bar"></div>
      </div>
      <div class="slider">
        <div class="slides" id="modelselection">
          <button
            id="first_btn"
            style="
              background-image: url('./images/earth-planet.png');"
            aria-label="Ï≤´Î≤àÏß∏ Î™®Îç∏"
            class="slide selected"
          ></button>
          <button
            id="second_btn"
            style="
              background-image: url('./images/earth-base.png');"
            aria-label="ÎëêÎ≤àÏß∏ Î™®Îç∏"
            class="slide"
          ></button>

        </div>
      </div>
    </model-viewer>

    <script type="module">
      const modelViewer = document.querySelector("model-viewer");
      const modelSelectionBar = document.getElementById("modelselection");
      const FirstBtn = document.getElementById("first_btn");
      const SecondBtn = document.getElementById("second_btn");
      const mapBtn = document.getElementById('map-btn');
     
              // --- 1. ÌñâÏÑ±Î≥ÑÎ°ú Ïó∞Í¥ÄÎêú Î™®Îç∏ Î™©Î°ùÏùÑ Ï†ïÏùò ---
      const planetRelatedModels = {
            earth: [
                { id: 'earth_globe', name: 'ÏßÄÍµ¨', thumbnail: './images/earth-planet.png', path: 'earth-planet', scale: '0.5 0.5 0.5' },
                { id: 'space_station', name: 'Ïö∞Ï£ºÏ†ïÍ±∞Ïû•', thumbnail: './images/earth-base.png', path: 'earth-base', scale: '0.2 0.2 0.2' },
            ],
            mars: [
                { id: 'mars_globe', name: 'ÌôîÏÑ±', thumbnail: './images/mars-planet.png', path: 'mars-planet', scale: '0.5 0.5 0.5' },
                { id: 'space_station', name: 'Ïö∞Ï£ºÏ†ïÍ±∞Ïû•', thumbnail: './images/mars-base.png', path: 'mars-base', scale: '0.2 0.2 0.2' },
            ],
            jupiter: [
                { id: 'jupiter_globe', name: 'Î™©ÏÑ±', thumbnail: './images/jupiter-planet.png', path: 'jupiter_planet', scale: '0.5 0.5 0.5' },
                { id: 'space_station', name: 'Ïö∞Ï£ºÏ†ïÍ±∞Ïû•', thumbnail: './images/mars_base.png', path: 'jupiter_base', scale: '0.2 0.2 0.2' },
            ],
            saturn: [
                { id: 'saturn_globe', name: 'ÌÜ†ÏÑ±', thumbnail: './images/saturn-planet.png', path: 'saturn_planet', scale: '0.5 0.5 0.5' },
                { id: 'space_station', name: 'Ïö∞Ï£ºÏ†ïÍ±∞Ïû•', thumbnail: './images/saturn-base.png', path: 'saturn-base', scale: '0.2 0.2 0.2' },
            ],
            uranus: [
                { id: 'uranus_globe', name: 'Ï≤úÏôïÏÑ±', thumbnail: './images/uranus-planet.png', path: 'uranus_planet', scale: '0.5 0.5 0.5' },
                { id: 'space_station', name: 'Ïö∞Ï£ºÏ†ïÍ±∞Ïû•', thumbnail: './images/uranus-base.png', path: 'uranus-base', scale: '0.2 0.2 0.2' },
            ],
            neptune: [
                { id: 'neptune_globe', name: 'Ìï¥ÏôïÏÑ±', thumbnail: './images/neptune-planet.png', path: 'neptune_planet', scale: '0.5 0.5 0.5' },
                { id: 'space_station', name: 'Ïö∞Ï£ºÏ†ïÍ±∞Ïû•', thumbnail: './images/neptune-base.png', path: 'neptune-base', scale: '0.2 0.2 0.2' },
            ],
            // ... Îã§Î•∏ ÌñâÏÑ±Îì§Ïùò Î™®Îç∏ Î™©Î°ùÎèÑ ÎèôÏùºÌïòÍ≤å Ï†ïÏùò ...
        };
    document.addEventListener('DOMContentLoaded', () => {
        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            // URLÏóêÏÑú 'planet' ÌååÎùºÎØ∏ÌÑ∞Î•º ÏùΩÏñ¥Ïò§Í≥†, ÏóÜÏúºÎ©¥ 'earth'Î•º Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏÇ¨Ïö©
            const planetId = urlParams.get('planet') || 'earth';
            const modelsToShow = planetRelatedModels[planetId];

            if (!modelsToShow) {
                alert("Ìï¥Îãπ ÌñâÏÑ±Ïùò Î™®Îç∏ Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
                return;
            }
            
            initModelSelectionBar(modelsToShow);
        }

        function initModelSelectionBar(models) {
     //       modelSelectionBar.innerHTML = '';

            modelViewer.src = "./models/" + models[0].path + ".glb";
            modelViewer.iosSrc = "./models/" + models[0].path + ".usdz";
            
            const FirstPath = models[0].path;
            FirstBtn.style.backgroundImage = `url('${models[0].thumbnail}')`;
            FirstBtn.setAttribute("onClick", `switchSrc(this, '${FirstPath}')`);

            const SecondPath = models[1].path;
            SecondBtn.style.backgroundImage = `url('${models[1].thumbnail}')`;
            SecondBtn.setAttribute("onClick", `switchSrc(this, '${SecondPath}')`);
        }   

        window.switchSrc = (element, name) => {
        const base = "./models/" + name;
        const ImgBase = "./images/" + name;
        modelViewer.src = base + ".glb";
        modelViewer.iosSrc = base + ".usdz";
        modelViewer.poster = ImgBase + ".png";
        const slides = document.querySelectorAll(".slide");
        slides.forEach((element) => {
          element.classList.remove("selected");
        });
        element.classList.add("selected");
      };

      document
        .querySelector(".slider")
        .addEventListener("beforexrselect", (ev) => {
          // Keep slider interactions from affecting the XR scene.
          ev.preventDefault();
        });

        mapBtn.onclick = () => window.location.href = './joayong-map.html';
    
        init();
    });

    

    </script>
    <script
      type="module"
      src="./js/model-viewer.min.js"
    ></script>

    <link rel="stylesheet" href="./css/joayong-photo.css" />

  </body>
</html>